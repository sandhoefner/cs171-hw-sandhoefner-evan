<!DOCTYPE html>
<meta charset="utf-8">
<title>Homework 2 Graph</title>
<style>
  .link {
    stroke: gray;
    stroke-width: .8px;
  }

  .node {
    fill: white;
    stroke: #000;
    stroke-width: .9px;
  }

  .node:hover {
    fill: black;
  }

.tab { margin-left: 40px; } 

</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="jsonNodes.js"></script>
  <!--<form>
  Layout:
    <label><input type="radio" name="layout" value="force" checked> Force</label>
    <label><input type="radio" name="layout" value="random" > Random</label>
    <label><input type="radio" name="layout" value="circular"> Circular</label>  
    <label><input type="radio" name="layout" value="line"> Line</label>
    <label><input type="radio" name="layout" value="line_cat"> Line by Category</label>
  </form>
  <form>
  Color:
    <label><input type="radio" name="color" value="nocolor" checked> None</label>
    <label><input type="radio" name="color" value="color_cat" > Category</label>
  </form>
  <form>
  Size:
    <label><input type="radio" name="size" value="nosize" checked> None</label>
    <label><input type="radio" name="size" value="size_cat" > Category</label>
  </form>-->
  
  <!--<form>
  Sort by:
    <select onchange="whichSort()">
      <option name="sortt" value="population" selected>Population</option>
      <option name="sortt" value="name">Name</option>
      <option name="sortt" value="gdp">GDP</option>
      <option name="sortt" value="life_expectancy">Life expectancy</option>
      <option name="sortt" value="latitude">Distance from equator</option>
    </select>
  </form>-->
  
  <form>
  Sort by:
    <label><input type="radio" id="pop" name="sort" value="population" checked > Population</label>
    <label><input type="radio" id="name" name="sort" value="name" > Name</label>
    <label><input type="radio" id="gdp" name="sort" value="gdp" > GDP</label>
    <label><input type="radio" id="life" name="sort" value="life_expectancy" > Life expectancy</label>
    <label><input type="radio" id="lat" name="sort" value="latitude" > Distance from equator</label>
  </form>
  <form>
  <div class="tab">Sort intervals:
    <label><input type="radio" id="constant" name="scale" value="constant" checked > Uniform</label>
    <label><input type="radio" name="scale" value="linScale" > Scaled</label>
  </div>
  </form>
  <form>
  Scatter by:
    <label><input type="radio" name="scatter" id="lat_lon" value="lat_lon" > Latitude and longitude</label>
    <label><input type="radio" name="scatter" id="pop_gdp" value="pop_gdp" > Population and GDP</label>
  </form>
  <!--<form>
  Scatter intervals:
    <label><input type="radio" name="s_scale" value="scatScale" checked> Scaled</label>
    <label><input type="radio" id="s_constant" name="s_scale" value="scatCon"  > Constant</label>
  </form>-->
  <form>
  Circle by:
    <label><input type="radio" name="circle" id="circle_pop" value="circle_pop" > Population</label>
    <label><input type="radio" name="circle" id="circle_gdp" value="circle_gdp" > GDP</label>
  </form>
  <form>
  Cluster:
  <label><input type="radio" name="group" id="all" value="all" > All</label>
    <label><input type="radio" name="group" id="strips" value="strips" > Strips</label>
    <label><input type="radio" name="group" id="wedges" value="wedges" > Wedges</label>
    <label><input type="radio" name="group" id="circles" value="circles" > Circles</label>
  </form>
  <!--<form>
    Transition time: <input type="text" name="speed">
  </form>-->
  <form>
  Links:
    <label><input type="radio" name="g_links" id="g_links" value="g_links" > Yes</label>
  </form>
<script>

// create svg canvas
var margin = {top: 50, bottom: 10, left: 300, right: 40};
var width = 1650 - margin.left - margin.right;
var height = 1750 - margin.top - margin.bottom;

var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

// create graph node-link structure
var graph = {nodes: [], links: []};

var nb_nodes = 120, nb_cat = 10;

var node_scale = d3.scale.linear().domain([0, nb_cat]).range([5, 50])

// create global variables for status of layout and status of sort

// load data into graph.nodes and update graph for the first time
d3.json("data/countries_2012.json", function(json) {

  jsonPop = json.sort(function(a, b) {
    if (a['population'] == b['population']) {
                    return d3.ascending(a['name'],b['name']);
                  } else {
            return d3.descending(a['population'],b['population']);
          }});

  var node = svg.selectAll(".node")
              .data(jsonPop)
            .enter()
              .append("g").attr("class", "node")
                          .attr("transform", function(d, i) { 
                            return "translate("+300+","+(8+i*14)+")"});


  
                    var groups = svg.selectAll("g")
                    
    .append("text")
    .attr("dx", 6)
    .attr("dy", 4.5)
    .text(function(d, i) {return d.name}); 


  node.append("circle")
    .attr("r", function(d) {
                              if (d.gdp > 500000000000) {
                                  return 9;
                              } else if (d.gdp > 195000000000) {
                                  return 8;
                                } else if (d.gdp > 45000000000) {
                                return 7;
                                } else if (d.gdp > 15700000000) {
                                return 6;
                                } else {
                                  return 5;
                                }
                          })
    .attr("fill", function(d) {
                              if (d.continent == "Africa") {
                                  return 'orange';
                              } else if (d.continent == "Asia") {
                                  return 'blue';
                                } else if (d.continent == "Americas") {
                                return 'yellow';
                                } else if (d.continent == "Oceania") {
                                return 'green';
                                } else {
                                  return 'red';
                                }
                          });

});



// layout functions (changes info within groups based on layout)
function constant_layout() {

if(document.getElementById('gdp').checked) {
  gdp_sort()
} else if(document.getElementById('name').checked) {
  name_sort()
} else if(document.getElementById('life').checked) {
  life_sort()
} else if(document.getElementById('lat').checked) {
  lat_sort()
} else if(document.getElementById('pop').checked) {
  pop_sort()
}
/*var node = svg.selectAll(".node");
node
            .transition().duration(1000)
              .attr("class", "node")
                          .attr("transform", function(d, i) { 
                            return "translate("+297+","+(8+i*14)+")"});*/
  
               
}

function linScale_layout() {
/*var node = svg.selectAll(".node");
node
            .transition().duration(1000)
              .attr("class", "node")
                          .attr("transform", function(d, i) { 
                            return "translate("+297+","+(8-(d.population-1205000000)/750000)+")"});*/
if(document.getElementById('gdp').checked) {
  gdp_sort()
} else if(document.getElementById('name').checked) {
  name_sort()
} else if(document.getElementById('life').checked) {
  life_sort()
} else if(document.getElementById('lat').checked) {
  lat_sort()
} else if(document.getElementById('pop').checked) {
  pop_sort()
}
}

function pop_sort() {
  var link = svg.selectAll(".link")
    .remove();
  force.stop();
if(document.getElementById('constant').checked) {

var json = jsonPop.sort(function(a, b) {
  if (a['population'] == b['population']) {
                    return d3.ascending(a['name'],b['name']);
                  } else {
            return d3.descending(a['population'],b['population']);
          }});



var json_names = json.map(function(d) {
  return d.name});



var node = svg.selectAll(".node");
node
            .transition().duration(1000)
              .attr("class", "node")  
                          .attr("transform", function(d, i) { 
                            return "translate("+297+","+(8+json_names.indexOf(d.name)*14)+")"});
} else {
var node = svg.selectAll(".node");
node
            .transition().duration(1000)
              .attr("class", "node")  
                          .attr("transform", function(d, i) { 
                            return "translate("+297+","+(8-(d.population-1205000000)/750000)+")"});
}
}

function gdp_sort() {
  var link = svg.selectAll(".link")
    .remove();
  force.stop();
  if(document.getElementById('constant').checked) {
  var json = jsonPop.sort(function(a, b) {
    if (a['gdp'] == b['gdp']) {
                    return d3.ascending(a['name'],b['name']);
                  } else {
            return d3.descending(a['gdp'],b['gdp']);
          }});



var json_names = json.map(function(d) {
  return d.name});



var node = svg.selectAll(".node");
node
            .transition().duration(1000)
              .attr("class", "node")  
                          .attr("transform", function(d, i) { 
                            return "translate("+297+","+(8+json_names.indexOf(d.name)*14)+")"});
} else {
var node = svg.selectAll(".node");
node
            .transition().duration(1000)
              .attr("class", "node")
                          .attr("transform", function(d, i) { 
                            return "translate("+297+","+(8-(d.gdp-16244600000000.0)/10000000000)+")"});
  }

}

function life_sort() {
  var link = svg.selectAll(".link")
    .remove();
  force.stop();
if(document.getElementById('constant').checked) {
var json = jsonPop.sort(function(a, b) {
  if (a['life_expectancy'] == b['life_expectancy']) {
                    return d3.ascending(a['name'],b['name']);
                  } else {
            return d3.descending(a['life_expectancy'],b['life_expectancy']);
          }});



var json_names = json.map(function(d) {
  return d.name});



var node = svg.selectAll(".node");
node
            .transition().duration(1000)
              .attr("class", "node")  
                          .attr("transform", function(d, i) { 
                            return "translate("+297+","+(8+json_names.indexOf(d.name)*14)+")"});
} else {
var node = svg.selectAll(".node");
node
            .transition().duration(1000)
              .attr("class", "node")
                          .attr("transform", function(d, i) { 
                            return "translate("+297+","+(8-(d.life_expectancy-83.5)/0.021)+")"});
}
}



function lat_sort() {
  var link = svg.selectAll(".link")
    .remove();
  force.stop();
if(document.getElementById('constant').checked) {
var json = jsonPop.sort(function(a, b) {
  if (Math.abs(a['latitude']) == Math.abs(b['latitude'])) {
                    return d3.ascending(a['name'],b['name']);
                  } else {
            return d3.descending(Math.abs(a['latitude']),Math.abs(b['latitude']));
          }});


var json_names = json.map(function(d) {
  return d.name});



var node = svg.selectAll(".node");
node
            .transition().duration(1000)
              .attr("class", "node")  
                          .attr("transform", function(d, i) { 
                            return "translate("+297+","+(8+json_names.indexOf(d.name)*14)+")"});
} else {
var node = svg.selectAll(".node");
node
            .transition().duration(1000)
              .attr("class", "node")
                          .attr("transform", function(d, i) { 
    return "translate("+297+","+(8-(Math.abs(d.latitude)-60.1608)/0.037)+")"});
}
}

function name_sort() {
  var link = svg.selectAll(".link")
    .remove();
  force.stop();
var json = jsonPop.sort(function(a, b) {
            return d3.ascending(a['name'],b['name']);
          });



var json_names = json.map(function(d) {
  return d.name});



var node = svg.selectAll(".node");
node
            .transition().duration(1000)
              .attr("class", "node")  
                          .attr("transform", function(d, i) { 
                            return "translate("+297+","+(8+json_names.indexOf(d.name)*14)+")"});

}

function scatter_lat_lon() {
  var link = svg.selectAll(".link")
    .remove();
  force.stop();
  /*if(document.getElementById('constant').checked) {

  } else {*/
var node = svg.selectAll(".node");
node
            .transition().duration(1000)
              .attr("class", "node")  
                          .attr("transform", function(d, i) { 
                            return "translate("+(d.longitude*4.3+450)+","+(-4.3*d.latitude+290)+")"});
}//}

function scatter_pop_gdp() {
  var link = svg.selectAll(".link")
    .remove();
  force.stop();
  /*if(document.getElementById('s_constant').checked) {

    var json_copy = jsonPop;
var json = jsonPop.sort(function(a, b) {
    if (a['gdp'] == b['gdp']) {
                    return d3.ascending(a['name'],b['name']);
                  } else {
            return d3.descending(a['gdp'],b['gdp']);
          }});

var json2 = json_copy.sort(function(a, b) {
    if (a['population'] == b['population']) {
                    return d3.ascending(a['name'],b['name']);
                  } else {
            return d3.descending(a['population'],b['population']);
          }});

console.log(json);
console.log(json2);

var json_names = json.map(function(d) {
  return d.name});
console.log(json_names);
var json2_names = json2.map(function(d) {
  return d.name});
console.log(json2_names);
var node = svg.selectAll(".node");
node
            .transition().duration(1000)
              .attr("class", "node")  
                          .attr("transform", function(d, i) { 
                            return "translate("+(json_names.indexOf(d.name)*14)+","+(8+json2_names.indexOf(d.name)*14)+")"});
  } else {*/
var node = svg.selectAll(".node");
node
            .transition().duration(1000)
              .attr("class", "node")  
                          .attr("transform", function(d, i) { 
    return "translate("+(8+d.gdp/13500000000)+","+(8-(d.population-1205000000)/2100000)+")"});

}

//}

function scatter() {
  var link = svg.selectAll(".link")
    .remove();
if(document.getElementById('lat_lon').checked) {
  scatter_lat_lon()
} else if(document.getElementById('pop_gdp').checked) {
  scatter_pop_gdp()
}
}

function circle_pop() {
  var link = svg.selectAll(".link")
    .remove();
  force.stop();
var r = Math.min(height, width)/2;

  var arc = d3.svg.arc()
          .outerRadius(r);

  var pie = d3.layout.pie()
          
          .value(function(d, i) { 
            return 1;  // We want an equal pie share/slice for each point
          });

var json = jsonPop.sort(function(a, b) {
  if (a['population'] == b['population']) {
                    return d3.ascending(a['name'],b['name']);
                  } else {
            return d3.descending(a['population'],b['population']);
          }});

  graph.nodes = pie(json).map(function(d, i) {
    // Needed to caclulate the centroid
    d.innerRadius = 0;
    d.outerRadius = r;

    // Building the data object we are going to return
    d.data.x = arc.centroid(d)[0]+400;
    d.data.y = arc.centroid(d)[1]+400;

    return d.data;
  })
var node = svg.selectAll(".node");
  node.transition().duration(1000)
      .attr("transform", function(d) { 
        return "translate("+d.x+","+d.y+")"; 
      });
}

function circle_gdp() {
  var link = svg.selectAll(".link")
    .remove();
  force.stop();
var r = Math.min(height, width)/2;

  var arc = d3.svg.arc()
          .outerRadius(r);

  var pie = d3.layout.pie()
          
          .value(function(d, i) { 
            return 1;  // We want an equal pie share/slice for each point
          });

var json = jsonPop.sort(function(a, b) {
  if (a['gdp'] == b['gdp']) {
                    return d3.ascending(a['name'],b['name']);
                  } else {
            return d3.descending(a['gdp'],b['gdp']);
          }});

  graph.nodes = pie(json).map(function(d, i) {
    // Needed to caclulate the centroid
    d.innerRadius = 0;
    d.outerRadius = r;

    // Building the data object we are going to return
    d.data.x = arc.centroid(d)[0]+400;
    d.data.y = arc.centroid(d)[1]+400;

    return d.data;
  })
var node = svg.selectAll(".node");
  node.transition().duration(1000)
      .attr("transform", function(d) { 
        return "translate("+d.x+","+d.y+")"; 
      });
}

var force = d3.layout.force()
    .size([750,750])
    .charge(-50)
    //.friction()
    //.gravity()
    .on("tick", tick
        ) 
    .on("start", function(d) {})
    .on("end", function(d) {});




function tick(d) {
  var k =  d.alpha;
  
  var node = svg.selectAll(".node");

  if (document.getElementById('all').checked) {

    var node = svg.selectAll(".node");
    node.transition().duration(0)
      .attr("transform", function(d) { 
        return "translate("+d.x+","+d.y+")"});

  } else if(document.getElementById('strips').checked) {
    node.transition().duration(0)
      .attr("transform", function(d) { 
        if (d.continent == 'Americas') {
          return "translate("+(d.x-=5*k)+","+(d.y)+")" ;
        } else if (d.continent == 'Africa') {
          return "translate("+(d.x+=10*k)+","+(d.y)+")"; 

        } else if (d.continent == 'Europe') {
          return "translate("+(d.x+=25*k)+","+(d.y)+")";

        } else if (d.continent == 'Asia') {
          return "translate("+(d.x+=40*k)+","+(d.y)+")";

        } else if (d.continent == 'Oceania') {
          return "translate("+(d.x+=55*k)+","+(d.y)+")"; 
        }
    });

  } else if (document.getElementById('wedges').checked) {

    node.transition().duration(0)
      .attr("transform", function(d) {      
        if (d.continent == 'Americas') {
          return "translate("+(d.x-=7.79*1.5*k)+","+(d.y+=1.5*k)+")" ;
        } else if (d.continent == 'Africa') {
          return "translate("+(d.x-=4.67*1.5*k)+","+(d.y-=9.09*1.5*k)+")"; 

        } else if (d.continent == 'Europe') {
          return "translate("+(d.x+=7.79*1.5*k)+","+(d.y+=1.5*k)+")";

        } else if (d.continent == 'Asia') {
          return "translate("+(d.x+=1.5*k)+","+(d.y+=5.5*1.5*k)+")";

        } else if (d.continent == 'Oceania') {
          return "translate("+(d.x+=4.67*1.5*k)+","+(d.y-=9.09*1.5*k)+")"; 
        }
    });
  } else if (document.getElementById('circles').checked) {
  var n = 2;
}
}

    //working tick
    /*
function tick(d) {
  var node = svg.selectAll(".node");
  node.transition().duration(0)
      .attr("transform", function(d) { 
        return "translate("+d.x+","+d.y+")"; 
      });
    */


//combine these
function strips() {
  var link = svg.selectAll(".link")
    .remove();
force.nodes(jsonPop)
      .start();
}


function wedges() {
  var link = svg.selectAll(".link")
    .remove();
force.nodes(jsonPop)
      .start();
}

function circles() {
  var link = svg.selectAll(".link")
    .remove();
circle_gdp();
}

function all() {
  var link = svg.selectAll(".link")
    .remove();
force.nodes(jsonPop)
      .start();
}

var jsonLinks = [];

jsonNodes.forEach(function(d, i) {
  d.years.forEach(function(e, j) {
    if(e.year == 2012) {
      e.top_partners.forEach(function(f, k) {
        jsonLinks.push({"source": d, "target": f})
})
}
  })
})



function g_links() {
  force.stop();
  var r = Math.min(height, width)/2;

  var arc = d3.svg.arc()
          .outerRadius(r);

  var pie = d3.layout.pie()
          
          .value(function(d, i) { 
            return 1;  // We want an equal pie share/slice for each point
          });

json = jsonPop.sort(function(a, b) {
  if (a['gdp'] == b['gdp']) {
                    return d3.ascending(a['name'],b['name']);
                  } else {
            return d3.descending(a['gdp'],b['gdp']);
          }});

  graph.nodes = pie(json).map(function(d, i) {
    // Needed to caclulate the centroid
    d.innerRadius = 0;
    d.outerRadius = r;

    // Building the data object we are going to return
    d.data.x = arc.centroid(d)[0]+400;
    d.data.y = arc.centroid(d)[1]+400;

    return d.data;
  })

var node = svg.selectAll(".node");
  node.transition().duration(1000)
      .attr("transform", function(d) { 
        return "translate("+d.x+","+d.y+")"; 
      });


  var link = svg.selectAll(".link")
              .data(jsonLinks);

link.enter().append("line")
    .attr("class", "link");



link.transition().duration(1000)
      .attr("x1", function(d) { 
        var ret;
          json.forEach(function(e, j) {
            if (e.name == d.source.name) {
              ret = e.x;
            }}); 
          return ret;})
      .attr("y1", function(d, i) { 
        var ret;
          json.forEach(function(e, j) {
            if (e.name == d.source.name) {
              ret = e.y;
            }}); 
          return ret;})
      .attr("x2", function(d, i) { 
        var ret;
       
          jsonNodes.forEach(function(e, j) {
            json.forEach(function(f, k) {
            if (e.country_id == d.target.country_id) {
              if (e.name == f.name) {
              ret = f.x;


            }}})}); 
          return ret;})
      .attr("y2", function(d, i) { 
        var ret;
       
          jsonNodes.forEach(function(e, j) {
            json.forEach(function(f, k) {
            if (e.country_id == d.target.country_id) {
              if (e.name == f.name) {
              ret = f.y;


            }}})}); 
          return ret;});
}

// update function - sorts data and calls appropriate layout function

// graph-update function - transforms svg groups to update actual visual

// listeners - tell us to update data appropriately
d3.select("input[value=\"linScale\"]").on("click", linScale_layout);
d3.select("input[value=\"constant\"]").on("click", constant_layout);

d3.select("input[value=\"gdp\"]").on("click", gdp_sort);
d3.select("input[value=\"life_expectancy\"]").on("click", life_sort);
d3.select("input[value=\"latitude\"]").on("click", lat_sort);
d3.select("input[value=\"name\"]").on("click", name_sort);
d3.select("input[value=\"population\"]").on("click", pop_sort);

d3.select("input[value=\"lat_lon\"]").on("click", scatter_lat_lon);
d3.select("input[value=\"pop_gdp\"]").on("click", scatter_pop_gdp);

d3.select("input[value=\"scatScale\"]").on("click", scatter);
d3.select("input[value=\"scatCon\"]").on("click", scatter);

d3.select("input[value=\"circle_pop\"]").on("click", circle_pop);
d3.select("input[value=\"circle_gdp\"]").on("click", circle_gdp);

d3.select("input[value=\"strips\"]").on("click", strips);
d3.select("input[value=\"wedges\"]").on("click", wedges);
d3.select("input[value=\"circles\"]").on("click", circles);
d3.select("input[value=\"all\"]").on("click", all);

d3.select("input[value=\"g_links\"]").on("click", g_links);

function whichSort() {
console.log('nope');
}
</script>
</body>
</html>